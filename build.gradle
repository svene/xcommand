plugins {
	id("java-library")
	id "com.github.ben-manes.versions" version "0.39.0"
}
project.ext {
	VERSION_JAVACC = '7.0.10'
	DEP_SERVLET_API = 'javax.servlet:javax.servlet-api:4.0.1'
	DEP_JANINO = 'org.codehaus.janino:janino:3.1.6'
	DEP_JAVASSIST = 'org.javassist:javassist:3.28.0-GA'
	DEP_JAVACC = "net.java.dev.javacc:javacc:${VERSION_JAVACC}"

	DEP_GROOVY = 'org.codehaus.groovy:groovy:3.0.9'
	DEP_LOMBOK_VERSION = '1.18.22'
	DEP_SPOCK_BOM = 'org.spockframework:spock-bom:2.0-groovy-3.0'
	DEP_SPOCK_CORE = 'org.spockframework:spock-core'
	DEP_JOOL = 'org.jooq:jool:0.9.14'

}

allprojects {
//	apply plugin: 'java'
	apply plugin: 'groovy'

	repositories {
		mavenCentral()
	}

	dependencies {
		implementation 'org.slf4j:slf4j-api:1.7.32'
		implementation 'org.slf4j:slf4j-simple:1.7.32'
		testImplementation 'org.junit.jupiter:junit-jupiter-api:5.8.2'
		testImplementation 'org.junit.jupiter:junit-jupiter-params:5.8.2'
		testRuntimeOnly 'org.junit.jupiter:junit-jupiter-engine:5.8.2'
		testImplementation 'org.assertj:assertj-core:3.21.0'
		testImplementation "org.mockito:mockito-core:4.2.0"
		testImplementation "org.mockito:mockito-junit-jupiter:4.2.0"
	}

	java {
		toolchain {
			languageVersion = JavaLanguageVersion.of(17)
		}
	}
	tasks.withType(JavaCompile) {
		options.deprecation = true
	}

	task ('copyToLib', type: Copy) {
		into('build/_artifacts')
		from configurations.compileClasspath
		from configurations.default.allArtifacts*.file
		from configurations.compileClasspath.allArtifacts*.file
	}

	task renameJCC(type: Copy, dependsOn: 'copyToLib') {
		from("build/_artifacts/javacc-${VERSION_JAVACC}.jar")
		into('build/_artifacts')
		rename("javacc-${VERSION_JAVACC}.jar", 'javacc.jar')
	}

	test {
		useJUnitPlatform {
//        	includeEngines 'junit-jupiter' // enabling this line causes spock tests not to be executed
		}
		testLogging {
			events /*'passed',*/ 'skipped', 'failed'
		}
	}
}
version = '1.0'

