plugins {
	id 'buildlogic.groovy-library-conventions'
	alias(libs.plugins.versions)
	id "org.xcommand.javacc"
}

javacc {
	inputFile = file("src/main/javacc/templateparser.jj")
	genDir    = file("build/src/java/org/collage/jcc")
}
compileJava.dependsOn(jcc)

dependencies {
	implementation project(':xc-core')
	implementation libs.javacc
	implementation libs.javassist

	implementation libs.slf4j.api
	implementation libs.slf4j.simple

	annotationProcessor libs.lombok
	compileOnly libs.lombok
	testAnnotationProcessor libs.lombok
	testCompileOnly libs.lombok

	testImplementation libs.mockito.core
	testImplementation libs.mockito.junit.jupiter

	implementation libs.jool
	testImplementation libs.assertj.core
	testImplementation platform(DEP_SPOCK_BOM)
	testImplementation libs.spock.core
}

sourceSets {
	main {
		java {
			srcDir 'build/src/java'
		}
	}
}

// ben-manes version-plugin:
def isNonStable = { String version ->
	def stableKeyword = ['RELEASE', 'FINAL', 'GA'].any { it -> version.toUpperCase().contains(it) }
	def regex = /^[0-9,.v-]+(-r)?$/
	return !stableKeyword && !(version ==~ regex)
}
// https://github.com/ben-manes/gradle-versions-plugin
tasks.named("dependencyUpdates").configure {
	rejectVersionIf {
		isNonStable(it.candidate.version)
	}
}
