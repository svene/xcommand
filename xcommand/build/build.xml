<project xmlns:ivy="antlib:fr.jayasoft.ivy.ant" name="hello-ivy" default="init" basedir="..">

	<property environment="env"/>

	<target name="init">
		<property name="src" value="src"/>
	</target>

	<target name="ivy" depends="init">
		<property name="ivy.default.ivy.user.dir" value="${env.HOME}/ivy"/>

		<ivy:configure file="build/ivyconf.xml"/>
		<property name="project.ivy.build.artifacts.dir" value="${ivy.project.dir}/output/artifacts"/>
		<ivy:resolve file="build/ivy.xml"/>
		<ivy:retrieve pattern="${project.ivy.build.artifacts.dir}/[conf]/[artifact].[ext]"/>
	</target>

	<target name="clean">
		<delete dir="output"/>
	</target>

	<target name="clobber" depends="clean">
		<delete dir="lib"/>
	</target>

	<target name="compile-core" depends="init">
		<compile-module aName="core"/>
	</target>
	<target name="jar-core" depends="compile-core">
		<jar-module aName="core"/>
	</target>

	<target name="compile-misc" depends="init">
		<compile-module aName="misc"/>
	</target>
	<target name="jar-misc" depends="compile-misc">
		<jar-module aName="misc"/>
	</target>

	<target name="compile-web" depends="init">
		<compile-module aName="web"/>
	</target>
	<target name="jar-web" depends="compile-web">
		<jar-module aName="web"/>
	</target>


	<macrodef name="compile-module">
		<attribute name="aName"/>
		<sequential>
		<mkdir dir="output/classes"/>
		<javac srcdir="${src}" destdir="output/classes" debug="true" source="1.4" target="1.4" classpath="output/artifacts/default/servletapi.jar">
			<include name="org/xcommand/@{aName}/**/*.java"/>
		</javac>
		</sequential>
	</macrodef>

	<macrodef name="jar-module">
		<attribute name="aName"/>
		<sequential>
		<jar destfile="output/xcommand-@{aName}.jar">
			<fileset dir="output/classes">
				<include name="org/xcommand/@{aName}/**/*"/>
			</fileset>
		</jar>
		</sequential>
	</macrodef>


</project>
